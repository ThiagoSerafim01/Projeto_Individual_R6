<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link data-react-helmet="true" rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64"
        href="./assets/imgs/favicon.ico">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="./css/perfil-cadastroTime.css">
    <title>Challenger</title>
</head>

<body>
    <main>

        <!-- SideBar do Perfil-->
        <div class="sidebar">
            <img class="icone-perfil" src="./assets/imgs/logo2.svg" alt="" width="42px">

            <h3><span id="b_usuario"></span></h3>
            <nav>
                <ul class="sidebar-lista">
                    <li>
                        <a href="perfil-agentes.html">
                            <img class="sidebar-icone-lista" width="54" height="54" viewBox="0 0 50 50"
                                src="./assets/imgs/agentes.svg">
                            <span href="perfil-agentes.html" class="sidebar-titulo">AGENTES</span>
                        </a>
                    </li>
                    <li>
                        <a href="perfil-times.html">
                            <img class="sidebar-icone-lista" width="54" height="54" viewBox="0 0 50 50"
                                src="./assets/imgs/invitational.png">
                            <span class="sidebar-titulo">TIMES</span>
                        </a>
                    </li>
                    <li>
                        <a href="perfil-cadastroTime.html">
                            <img class="sidebar-icone-lista" width="54" height="54" viewBox="0 0 50 50"
                                src="./assets/imgs/challenger.png">
                            <span class="sidebar-titulo">CHALLENGER</span>
                        </a>
                    </li>
                    <li>
                        <a href="perfil-quiz.html">
                            <img class="sidebar-icone-lista" width="54" height="54" viewBox="0 0 50 50"
                                src="./assets/imgs/challenger.png">
                            <span class="sidebar-titulo">QUIZ</span>
                        </a>
                    </li>
                    <li>
                        <a href="indexR6.html">
                            <span class="sidebar-titulo"><img src="./assets/imgs/r6s-y6-logo.webp"></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        </div>

        <!--TITULO DA PAGINA-->
        <div class="configuracoes-titulo">
            <h1>CHALLENGER</h1>
        </div>
        <!--CONTAINER QUE ENGLOBA O CONTEUDO-->
        <div class="container-all">
            <div id="titulo_2_empresa" class="titulo-2">
                <h3 id="titulo_div_empresa">Cadastre seu Time</h3>
                <p id="subtitulo_div_empresa">
                    Insira os dados do seu Time
                </p>
            </div>
            <div class="container-pai">
                <div id="container_filho_empresa" class="container-filho">
                    <div id="nome_org_box" class="estilo-box">
                        <p id="nome_org_cadastro">ORGANIZAÇÃO*</p>
                        <input class="input-empresa" id="inputOrg" placeholder="Nome do seu Time"
                            onblur="validarEmpresa()" required />
                    </div>
                    <div id="regiao_org_box" class="estilo-box">
                        <p id="regiao_org_cadastro">REGIÃO*</p>
                        <input class="input-empresa" id="inputRegiao" placeholder="Ex: Latam"
                            onblur="validarRegiao()" required />
                    </div>
                    <div id="logradouro_org_box" class="estilo-box">
                        <p id="logradouro_org_cadastro">Logradouro*</p>
                        <input class="input-empresa" id="inputLogradouro" placeholder="Ex: Av Paulista"
                            onblur="validarLogradouro()" required />
                    </div>
                </div>
                <div class="container-filho-2">
                    <div id="cep_empresa_box" class="estilo-box">
                        <p id="cep_empresa_cadastro">CEP*</p>
                        <input class="input-empresa" id="inputCEP" placeholder="Ex: 08150200" onblur="validarCEP()"
                            required />
                    </div>

                    <div id="bairro_empresa_box" class="estilo-box">
                        <p id="bairro_empresa_cadastro">Bairro</p>
                        <input class="input-empresa" id="inputBairro" placeholder="Ex: Jd.ROBRU"
                            onblur="validarBairro()" />
                    </div>

                    <div id="complemento_org_box" class="estilo-box">
                        <p id="complemento_empresa_cadastro">Complemento</p>
                        <input class="input-empresa active" id="inputComplemento" placeholder="AP F 23"
                            onblur="validarComplemento()" />
                    </div>
                </div>
            </div>

            <button id="btn_cadastrar_org" class="botao-registro" onclick="cadastrarOrg()">
                CADASTRAR
            </button>

            <!-- REGISTRO DO JOGADORES -->
            <hr />
            <div class="titulo-2 funcionarios">
                <h3>Cadastre os Jogadores</h3>
                <p>Insira os dados de seus jogadores que você deseja cadastrar</p>
            </div>
            <div class="container-pai">
                <div class="container-filho">
                    <div class="estilo-box">
                        <p>Username*</p>
                        <input class="input-empresa" id="inputUsuario" onblur="validarUsuario()"
                            placeholder="Ex: Alem4o" required />
                    </div>
                    <div class="estilo-box">
                        <p>Nome Completo*</p>
                        <input class="input-empresa" id="inputNome" placeholder="Ex: Thiago Serafim" required
                            onblur="validarNome()" />
                    </div>
                </div>
                <div class="container-filho-2">
                    <div class="estilo-box">
                        <p>E-mail*</p>
                        <input class="input-empresa" id="inputEmail" placeholder="Ex: thiago.serafim@sptech.school"
                            required onblur="validarEmail()" />
                    </div>

                    <div class="estilo-box">
                        <p>Telefone</p>
                        <input class="input-empresa" type="number" placeholder="Ex: 11951762698" id="inputContato"
                            onkeyup="validarContato()" />
                    </div>

                    <div class="estilo-box">
                        <p>Função</p>
                        <select class="combo-funcao" id="inputFuncao">
                            <option value=""></option>
                            <option value="Capitão">Capitão</option>
                            <option value="Suporte">Suporte</option>
                            <option value="Intermediário">Intermediário</option>
                            <option value="Lurker">Lurker</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="botao-registro" onclick="cadastrarFuncionario()">
                CADASTRAR
            </button>
            <hr />
            <div id="tabela_funcionarios" class="tabela-funcionarios">
                <h3>JOGADORES</h3>
            </div>
        </div>
    </main>
</body>

</html>

</main>
</body>

</html>

<script src="./js/perfil-validacao.js"></script>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    function buscarDadosOrganizacao() {
      if (sessionStorage.ID_ORGANIZACAO) {
        fetch(`/organizacao?id=${sessionStorage.ID_ORGANIZACAO}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then(function (resposta) {
            if (resposta.ok) {
              resposta.json().then((json) => {
                console.log(json);
                //nome da org
                var nome_Org = json.nomeOrg;
                titulo_div_empresa.innerHTML = nome_Org;
                subtitulo_div_empresa.remove();
                inputOrg.remove();
                nome_org_cadastro.innerHTML = `Nome da Organização`;
                nome_org_box.innerHTML += nome_Org;

                //regiao da org
                var regiao_org = json.regiao;
                inputRegiao.remove();
                regiao_org_box.innerHTML += regiao_org;
                regiao_org_cadastro.innerHTML = "Região";

                //Logradouro da org
                var logradouro_empresa = json.logradouro;
                inputLogradouro.remove();
                logradouro_org_box.innerHTML += logradouro_empresa;
                logradouro_org_cadastro.innerHTML = "Logradouro";

                //Cep da org
                var cep_empresa = Number(json.cep);
                inputCEP.remove();
                cep_empresa_box.innerHTML += cep_empresa;
                cep_empresa_cadastro.innerHTML = "CEP";

                //Bairro da org
                var bairro_empresa = json.bairro;
                inputBairro.remove();
                bairro_empresa_box.innerHTML += bairro_empresa;

                //Complemento da org
                var complemento_empresa = json.complemento;
                inputComplemento.remove();
                complemento_org_box.innerHTML += complemento_empresa;

                btn_cadastrar_org.remove();
                document.getElementById(
                  "container_filho_empresa"
                ).style.marginLeft = "17vw";
                document.getElementById("titulo_2_empresa").style.marginLeft =
                  "12vw";
              });
            }
          })
          .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
          });
      }
    }

    function buscarDadoFuncionario() {
      var idOrganizacao = sessionStorage.ID_ORGANIZACAO;
    fetch(`/funcionario/listarFuncionario/${idEmpresa}`)
      .then(function (resposta) {
        console.log('estou na Buscarfuncionario()',resposta);
        if (resposta.ok) {
          if (resposta.status == 204) {
            var tabelaFuncionarios = document.getElementById("tabela_funcionarios");
            var mensagem = document.createElement("span");
            mensagem.classList.add('mensagem');
            mensagem.innerHTML = "Nenhum resultado encontrado.";
            tabelaFuncionarios.appendChild(mensagem);
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));

            var tabelaFuncionarios = document.getElementById("tabela_funcionarios");
            tabelaFuncionarios.innerHTML = "<h3>FUNCIONÁRIOS</h3>";
            for (let i = 0; i < resposta.length; i++) {
              var publicacao = resposta[i];

              // criando e manipulando elementos do HTML via JavaScript

              tabelaFuncionarios.innerHTML+=`
                        
              <div class="func" id="${i}">
                      <div class="estilo-atributos">
                        <h5>Login:</h5>
                        <p>${publicacao.username}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Nome Completo:</h5>
                        <p>${publicacao.nome}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Email:</h5>
                        <p>${publicacao.email}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Telefone:</h5>
                        <p>${publicacao.telefone}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Função:</h5>
                        <p>${publicacao.funcao}</p>
                      </div>
                      <button class="removerCard" onclick="removerCard(${i})">Remover</button>
                  </div>
                    `;
            }
          });
        } else {
          throw console.log('Estou na buscarDadosFuncionario()',JSON.stringify(resposta));
        }
      })
      .catch(function (resposta) {
        console.log(resposta);
      });
    }

    function cadastrarOrg() {
      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo
      var orgNomeVar = inputOrg.value;
      var regiaojVar = inputRegiao.value;
      var logradouroVar = inputLogradouro.value;
      var cepVar = inputCEP.value;
      var bairroVar = inputBairro.value;
      var complementoVar = inputComplemento.value;

      // Enviando o valor da nova input
      fetch("/organizacao/cadastrarOrganizacao", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/organizacao.js
          idPerfil: sessionStorage.ID_PERFIL,
          empresaNomeServer: orgNomeVar,
          cnpjServer: regiaojVar,
          logradouroServer: logradouroVar,
          bairroServer: bairroVar,
          complementoVar: complementoVar,
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);
  // Se sucesso, ele atualiza o id da empresa dentro da sessionStorage e atualiza a pág
          if (resposta.ok) {
            resposta.json().then((idEmpresa) => {
              sessionStorage.ID_ORGANIZACAO = idOrganizacao;
            });

            alert("Cadastro realizado com sucesso!");
            window.location.reload();
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
          // finalizarAguardar();
        });

      return false;
    }

    function sumirMensagem() {
      cardErro.style.display = "none";
    }

    function cadastrarFuncionario() {
      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo
      var userVar = inputUsuario.value;
      var nomeVar = inputNome.value;
      var emailVar = inputEmail.value;
      var contatoVar = inputContato.value;
      var funcaoVar = inputFuncao.value;
      var idOrganizacao = sessionStorage.ID_ORGANIZACAO;

      fetch(`/funcionario/cadastrarFuncionario/${idOrganizacao}`,{
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/funcionario.js
          idOrganizacao: sessionStorage.ID_ORGANIZACAO,
          userServer: userVar,
          nomeServer: nomeVar,
          emailServer: emailVar,
          contatoServer: contatoVar,
          funcaoServer: funcaoVar,
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta, sessionStorage.ID_ORGANIZACAO);

          if (resposta.ok) {
            alert("Cadastro realizado com sucesso!");

            setTimeout(() => {
              window.location.reload();
            }, "500");
          } else {
            alert("Houve um erro ao tentar realizar o cadastro!");
            console.log("respostaaaa: ", resposta, sessionStorage.ID_ORGANIZACAO);
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

      return false;
    }

    function sumirMensagem() {
      cardErro.style.display = "none";
    }

    // chama a função assim que a pagina carrega
    buscarDadosEmpresa();
</script>